---

# 📌 `gpt_plan.py` 更新日志（2025-04-23）

### 🎯 更新目标：
实现基于 **昨天任务完成情况（含预计/实际耗时）** 的今日任务智能规划，结合论文阶段自动推进进度、时间反馈、资源路径，全面优化日志追踪和计划质量。

---

## 🆕 V1.4 更新内容

### ✅ 1. 支持从昨天的任务生成今天计划
- 自动读取 Logseq 中前一日的 journal 文件（如 `2025_04_22.md`）；
- 区分 `DONE` 与 `TODO`，并提取任务内容、耗时/预计时长；
- 根据昨天完成率、阶段时间进度比，为今天生成更合理的任务量。

### ✅ 2. 预计时长与实际耗时追踪逻辑
- 支持 `TODO` 行内标注 `(预计 Xh)` 和 `[已耗时 Xh]`；
- 支持 `DONE` 行内标注 `[耗时 Xh]`；
- 自动统计：
  - 总预计时间 `total_est`
  - 实际耗时 `total_spent`
  - 完成效率 `efficiency = spent / est`

### ✅ 3. GPT 生成任务逻辑优化（更“个性化 + 自适应”）
- 若效率过低（>110%）：生成较轻负担任务 1–2 条；
- 若效率良好（<90%）：生成挑战性任务 2–3 条；
- 所有任务：
  - 中文输出，动词开头，30 字以内；
  - 每条含 `(预计 Xh)` 时长提示；
  - 检查路径存在（如仿真 case）；
  - 输出格式简洁，无编号。

### ✅ 4. Logseq 写入逻辑强化
- 自动在当日日志文件追加：
  ```
  ## GPT 任务 · 10:40
  - 阶段：P0
  - 时间进度：22%
  - 昨日完成率：66%
  - 昨日预计/实际：6.0h / 8.2h
  - TODO 调整 50m 波长仿真设置 (预计 1.5h)
  - TODO 导出初步结果曲线进行比对 (预计 2.0h)
  ...
  ```
- 保留用户已有笔记段落，仅更新 GPT 部分；
- 可自定义是否覆盖旧任务段（默认保留最新一条）。

### ✅ 5. 更清晰的代码结构
- 各阶段定义集中统一（`PHASES`）；
- 所有正则清晰命名（`DUR_DONE`, `DUR_TODO`, `EST_RE`）；
- 函数职责更明确：`parse_tasks_for_date()`、`gpt_next_steps()`、`append_to_logseq()`。

---

## 🚧 后续建议（V1.5+）
| 功能 | 说明 |
|------|------|
| 📈 任务完成趋势图 | 生成最近一周的任务完成/耗时曲线 |
| 📊 成效评分 | 结合完成率、效率、阶段进度自动评分 |
| 🤖 自动化推送 | 每日 16:30 定时运行 → Feishu/TickTick 通知 |
| ⏳ 专注追踪 | 自动统计 `TODO` 转 `DONE` 的平均用时 |
| 🧠 GPT 回顾反馈 | 结合每日任务 → 自动生成自然语言总结 |

---
